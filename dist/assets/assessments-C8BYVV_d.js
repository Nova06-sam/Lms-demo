import{u as R,r as n,j as e,L as _}from"./index-BgvmjoPK.js";import{c as D}from"./index-UswyhjMM.js";import{I as v}from"./index-C4xZWEtb.js";import{L as w}from"./index-rsXDEfbO.js";import{b as L}from"./index-DYv1qxzQ.js";import{G as C}from"./index-BY49YPNJ.js";import{B as M}from"./BackDashboard-cToXFvJ9.js";import{a as h}from"./index-B9ygI19o.js";import"./iconBase-BpTAibu1.js";function ae(){R();const[Q,z]=n.useState(!1),[B,O]=n.useState(null),[G,J]=n.useState(null),[q,Y]=n.useState(null),[i,A]=n.useState("Available"),[g,f]=n.useState([]),[S,k]=n.useState([]),[V,T]=n.useState([]),[t,j]=n.useState(null),[U,y]=n.useState(!0);n.useEffect(()=>{(async()=>{try{y(!0);const m=JSON.parse(localStorage.getItem("user"))?._id,[p,c]=await Promise.all([h.get("http://localhost:5000/api/assessments/all"),h.get(`http://localhost:5000/api/submissions/student/${m}`)]),d=c.data?.data?.map(l=>l.assessmentId)||[],x=p.data?.data?.map(l=>{const o=c.data?.data?.find(E=>E.assessmentId===l._id),$=d.includes(l._id);return{id:l._id,title:l.title,course:l.course||"Unassigned",type:l.assessmentType,duration:`${l.durationMinutes||0} mins`,maxScore:l.maxScore||0,status:l.status||"draft",isCompleted:$,submission:o||null,performance:o?.score||null,grade:o?.grade||"Not graded",correctAnswers:o?.correctAnswers||0,totalQuestions:o?.totalQuestions||0,timeTaken:o?.timeTaken||0,marks:o?.marks||0,passed:o?.passed||!1,answers:o?.answers||[],submittedAt:o?.submittedAt}})||[];f(x),T(c.data?.data||[]);const u=x.filter(l=>l.status==="published"&&!l.isCompleted).length,r=x.filter(l=>l.isCompleted).length,b=x.filter(l=>l.status==="draft"||l.status==="scheduled").length;k([{id:1,title:"Available Assessments",number:u,icon:e.jsx(v,{}),text:"Ready to take"},{id:2,title:"Completed",number:r,icon:e.jsx(w,{}),text:"Finished assessments"},{id:3,title:"Upcoming",number:b,icon:e.jsx(C,{}),text:"Scheduled for later"},{id:4,title:"Success Rate",number:r>0?`${Math.round(x.filter(l=>l.passed).length/r*100)}%`:"0%",icon:e.jsx(L,{}),text:"Pass rate"}])}catch(a){console.error("Error fetching assessments:",a)}finally{y(!1)}})()},[]);const F=[{label:"Available",status:"available",count:g.filter(s=>s.status==="published"&&!s.isCompleted).length},{label:"Completed",status:"completed",count:g.filter(s=>s.isCompleted).length},{label:"Upcoming",status:"upcoming",count:g.filter(s=>s.status==="draft"||s.status==="scheduled").length}],N=g.filter(s=>i==="Available"?s.status==="published"&&!s.isCompleted:i==="Completed"?s.isCompleted:i==="Upcoming"?s.status==="draft"||s.status==="scheduled":!1),I=async(s,a,m,p,c)=>{const d=s.target.files[0];if(!d)return;if(!["application/pdf","text/plain","application/zip"].includes(d.type)){toast.error("Please upload only .pdf, .txt, or .zip files");return}const u=JSON.parse(localStorage.getItem("user")),r=new FormData;r.append("file",d),r.append("studentId",u?._id),r.append("studentName",u?.name||"Unknown"),r.append("studentEmail",u?.email||"unknown@gmail.com"),r.append("assessmentId",a),r.append("assessmentType",m),r.append("assesmentCourse",p),r.append("assesmentTitle",c);try{(await h.post("http://localhost:5000/api/submissions/upload",r,{headers:{"Content-Type":"multipart/form-data"}})).data.success?(toast.success("âœ… File uploaded successfully!"),window.location.reload()):toast.error("âŒ Upload failed, please try again.")}catch(b){console.error("Upload error:",b),toast.error("Error uploading file.")}},P=async()=>{const s=JSON.parse(localStorage.getItem("user"));try{const[a,m]=await Promise.all([h.get("http://localhost:5000/api/assessments/all"),h.get(`http://localhost:5000/api/submissions/student/${s?._id}`)]),p=m.data?.data?.map(d=>d.assessmentId)||[],c=a.data?.data?.map(d=>({...d,isCompleted:p.includes(d._id)}))||[];f(c)}catch(a){console.error("Error refreshing assessments:",a)}};return n.useEffect(()=>{(()=>{new URLSearchParams(window.location.search).get("completed")==="true"&&(P(),window.history.replaceState({},document.title,window.location.pathname))})()},[]),e.jsxs("div",{className:"p-5 sm:p-10 bg-gray-100 min-h-screen",children:[e.jsx(M,{}),e.jsxs("div",{className:"mt-10",children:[e.jsx("h1",{className:"text-3xl sm:text-4xl font-semibold",children:"Assessments & Evaluations"}),e.jsx("p",{className:"text-gray-500 mt-2 text-sm sm:text-base",children:"Complete assessments to track your progress and earn skill ratings."})]}),U?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"main-card grid grid-cols-1 sm:grid-cols-2 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 mt-10",children:S.map(s=>e.jsxs("div",{className:"border border-gray-200 shadow-md bg-white p-5 rounded-xl h-40 hover:shadow-lg transition",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("p",{className:"text-lg font-medium",children:s.title}),e.jsx("span",{className:"text-2xl text-blue-600",children:s.icon})]}),e.jsx("h1",{className:"text-3xl py-3 font-semibold",children:s.number}),e.jsx("p",{className:"text-sm text-gray-500",children:s.text})]},s.id))}),e.jsx("div",{className:"Filter-Buttons flex flex-wrap gap-2 sm:gap-4 mt-10 bg-gray-200 rounded-full w-fit px-3 py-2",children:F.map(s=>e.jsxs("button",{onClick:()=>A(s.label),className:`btn rounded-full px-5 py-1.5 text-sm sm:text-base font-medium transition ${i===s.label?"bg-white shadow-md text-blue-600":"hover:bg-white hover:text-gray-800 text-gray-600"}`,children:[s.label," (",s.count,")"]},s.label))}),e.jsx("div",{className:"mt-6 space-y-5",children:N.length===0?e.jsxs("div",{className:"text-center py-10 bg-white rounded-xl",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“­"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-700 mb-2",children:i==="Available"?"No Available Assessments":i==="Completed"?"No Completed Assessments":"No Upcoming Assessments"}),e.jsx("p",{className:"text-gray-500",children:i==="Available"?"All assessments have been completed. Check the Completed tab to view results.":i==="Completed"?"You haven't completed any assessments yet. Check the Available tab.":"No upcoming assessments scheduled."})]}):N.map(s=>e.jsx("div",{className:"p-5 sm:p-7 bg-white rounded-xl shadow-sm hover:shadow-md border border-gray-200",children:e.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`p-3 shadow-xl rounded-2xl text-2xl text-white ${s.isCompleted?"bg-green-500":"bg-blue-500"}`,children:s.isCompleted?e.jsx(w,{}):e.jsx(v,{})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg sm:text-xl font-semibold",children:s.title}),e.jsx("p",{className:"text-gray-600 text-sm sm:text-base",children:s.course}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-2",children:[e.jsx("span",{className:"text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded",children:s.type}),e.jsx("span",{className:"text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded",children:s.duration}),e.jsxs("span",{className:"text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded",children:["Max Score: ",s.maxScore]})]})]})]}),i==="Available"&&!s.isCompleted&&e.jsxs("div",{className:"flex flex-wrap justify-start md:justify-end gap-3 items-center",children:[e.jsx("span",{className:"text-sm bg-green-100 text-green-700 rounded-full py-1 px-3 font-medium",children:"Available"}),s.type==="MCQ"?e.jsxs(_,{to:`/student/assessment/quiz/${s.id}`,className:"flex items-center gap-2 text-sm sm:text-base bg-blue-500 hover:bg-blue-600 rounded-xl text-white px-4 py-2 transition",children:[e.jsx(D,{}),"Start Assessment"]}):e.jsx("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-3",children:e.jsxs("div",{children:[e.jsxs("label",{htmlFor:`upload-${s.id}`,className:"block text-sm text-gray-600 mb-1",children:["Upload your ",s.type," answer:"]}),e.jsx("input",{id:`upload-${s.id}`,type:"file",accept:".pdf,.txt,.zip",onChange:a=>I(a,s.id,s.type,s.course,s.title),className:"block w-full text-sm text-gray-700 bg-gray-50 border border-gray-300 rounded-lg p-2 cursor-pointer hover:border-blue-400 transition"})]})})]}),i==="Completed"&&s.isCompleted&&e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`text-sm rounded-full py-1 px-3 font-medium ${s.passed?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:s.passed?"Passed":"Failed"}),e.jsxs("span",{className:"text-sm bg-blue-100 text-blue-700 rounded-full py-1 px-3",children:["Score: ",s.marks,"/",s.maxScore]})]}),e.jsx("button",{onClick:()=>j(s),className:"text-sm bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-full px-4 py-2 transition",children:"View Details"})]}),i==="Upcoming"&&e.jsx("div",{className:"flex justify-end",children:e.jsxs("div",{className:"flex gap-2 text-sm bg-yellow-100 text-yellow-700 rounded-xl px-4 py-2 items-center",children:[e.jsx(C,{}),e.jsx("p",{children:"Scheduled"})]})})]})},s.id))}),t&&t.submission&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black/40 z-50 overflow-auto p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-4xl p-6 relative max-h-[90vh] overflow-y-auto",children:[e.jsx("button",{onClick:()=>j(null),className:"absolute top-3 right-3 text-gray-500 hover:text-black text-xl",children:"âœ–"}),e.jsx("h2",{className:"text-2xl font-semibold mb-2 text-blue-600",children:t.title}),e.jsx("p",{className:"text-gray-600 mb-4",children:t.course}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm mb-5",children:[e.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg border",children:[e.jsx("b",{children:"Student:"}),e.jsx("p",{className:"truncate",children:t.submission.studentName})]}),e.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg border",children:[e.jsx("b",{children:"Score:"}),e.jsxs("p",{className:"text-lg font-semibold",children:[t.marks,"/",t.maxScore]})]}),e.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg border",children:[e.jsx("b",{children:"Grade:"}),e.jsx("p",{className:`text-lg font-semibold ${t.grade==="A"?"text-green-600":t.grade==="B"?"text-blue-600":t.grade==="C"?"text-yellow-600":t.grade==="D"?"text-orange-600":"text-red-600"}`,children:t.grade})]}),e.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg border",children:[e.jsx("b",{children:"Status:"}),e.jsx("p",{className:`font-medium ${t.passed?"text-green-600":"text-red-600"}`,children:t.passed?"âœ… Passed":"âŒ Failed"})]})]}),t.type==="MCQ"&&t.answers.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-lg font-semibold mb-3 border-b pb-2",children:"Question Analysis"}),e.jsx("div",{className:"space-y-3 mb-6",children:t.answers.map((s,a)=>e.jsxs("div",{className:`p-4 rounded-lg border ${s.isCorrect?"border-green-400 bg-green-50":"border-red-400 bg-red-50"}`,children:[e.jsxs("p",{className:"font-medium text-gray-800 mb-2",children:["Q",a+1,". ",s.questionText]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("b",{children:"Your Answer:"}),e.jsx("p",{className:s.isCorrect?"text-green-600":"text-red-600",children:s.selectedAnswer})]}),e.jsxs("div",{children:[e.jsx("b",{children:"Correct Answer:"}),e.jsx("p",{className:"text-green-600",children:s.correctAnswer})]})]})]},s._id||a))})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Submission Details"}),e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsxs("p",{children:[e.jsx("b",{children:"Submitted at:"})," ",new Date(t.submittedAt).toLocaleString()]}),e.jsxs("p",{children:[e.jsx("b",{children:"Time Taken:"})," ",t.timeTaken," seconds"]}),e.jsxs("p",{children:[e.jsx("b",{children:"Correct Answers:"})," ",t.correctAnswers," out of ",t.totalQuestions]}),t.submission.feedback&&e.jsxs("p",{className:"mt-2",children:[e.jsx("b",{children:"Feedback:"})," ",t.submission.feedback]})]})]})]})})]})]})}export{ae as default};
