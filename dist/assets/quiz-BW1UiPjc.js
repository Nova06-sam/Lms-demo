import{u as M,r as n,b as $,j as e}from"./index-BgvmjoPK.js";import{j as P,y as R}from"./index-m96ZVajk.js";import{a as U}from"./index-D6x1koeM.js";import{F as B}from"./index-CkG1-yBZ.js";import{g as O}from"./index-Cc-SIf8Y.js";import{B as V}from"./BackDashboard-cToXFvJ9.js";import{a as C}from"./index-B9ygI19o.js";import"./iconBase-BpTAibu1.js";import"./index-UswyhjMM.js";function se(){const p=M(),[x,j]=n.useState(0),{id:h}=$(),[l,k]=n.useState([]),[N,T]=n.useState(""),[A,Q]=n.useState(!0),[a,b]=n.useState(0),[i,z]=n.useState({}),[g,D]=n.useState(0),[d,w]=n.useState(!1),[y,_]=n.useState(Date.now()),[f,E]=n.useState({});n.useEffect(()=>{if(!x||d)return;const s=setInterval(()=>{j(t=>t<=1?(clearInterval(s),w(!0),0):t-1)},1e3);return()=>clearInterval(s)},[x,d]),n.useEffect(()=>{(async()=>{try{const t=await C.get(`http://localhost:5000/api/assessments/${h}`);if(t.data.success&&t.data.data){const r=t.data.data;E(t.data.data),T(r.title||"Untitled Assessment");const c=(r.questions||[]).map(u=>({id:u._id,question:u.questionText,options:u.options||[],answer:u.answer}));k(c),r.durationMinutes&&j(r.durationMinutes*60),console.log(t.data.data)}}catch(t){console.error("Error fetching quiz:",t)}finally{Q(!1)}})()},[h]),n.useEffect(()=>{if(d){const s=JSON.parse(localStorage.getItem("user")),t={assesmentTitle:f.title,assesmentCourse:f.course,assessmentId:h,studentId:s?._id||"unknown",studentName:s?.name||"Guest User",studentEmail:s?.email||"unknown@example.com",studentPhoto:s?.photoURL||"",provider:s?.provider||"",role:s?.role||"student",totalQuestions:l.length,correctAnswers:g,percentage:m,timeTaken:S,startedAt:new Date(y),submittedAt:new Date,skills:f.skills||[],answers:l.map((r,c)=>({questionId:r.id,questionText:r.question,selectedAnswer:i[c],correctAnswer:r.answer,isCorrect:i[c]===r.answer}))};C.post("http://localhost:5000/api/submissions/submit",t).then(r=>{console.log("✅ Quiz submission saved successfully:",r.data)}).catch(r=>{console.error("❌ Error saving submission:",r)})}},[d]);const o=l.length,F=s=>{i[a]||(z({...i,[a]:s}),s===l[a].answer&&D(t=>t+1))},I=()=>{a<o-1?b(a+1):w(!0)},q=()=>{a>0&&b(a-1)},L=(a+1)/o*100,m=Math.round(g/o*100),v=Object.keys(i).length,S=Math.round((Date.now()-y)/1e3);return A?e.jsx("div",{className:"flex justify-center items-center min-h-screen text-gray-600 text-lg",children:"Loading quiz..."}):l.length?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"bg-gray-50 min-h-screen p-6",children:[e.jsx(V,{}),d?e.jsxs("div",{className:"max-w-4xl w-full mt-10 mx-auto bg-white p-10 rounded-2xl shadow-md text-center",children:[e.jsxs("div",{className:"flex flex-col items-center mb-8",children:[m>=70?e.jsx(P,{className:"text-green-500 text-6xl mb-3"}):e.jsx(R,{className:"text-red-500 text-6xl mb-3"}),e.jsx("h2",{className:"text-2xl font-semibold mb-2",children:"Quiz Completed!"}),e.jsx("p",{className:"text-gray-600 mb-4",children:N}),e.jsxs("h1",{className:"text-5xl font-bold mb-2",children:[m,"%"]}),e.jsxs("p",{className:"text-gray-500",children:["You need ",e.jsx("span",{className:"font-semibold",children:"70%"})," to pass"]}),e.jsx("span",{className:`mt-3 px-4 py-1 rounded-full text-sm font-medium ${m>=70?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:m>=70?"PASSED":"FAILED"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsxs("div",{className:"bg-gray-50 flex flex-col justify-center items-center p-4 rounded-xl",children:[e.jsx(U,{className:"text-4xl text-blue-500"}),e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"Questions Answered"}),e.jsxs("h3",{className:"text-xl font-bold",children:[Math.round(v/o*100),"%"]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 flex flex-col justify-center items-center rounded-xl",children:[e.jsx(B,{className:"text-4xl text-green-500"}),e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"Correct Answers"}),e.jsx("h3",{className:"text-xl font-bold",children:g})]}),e.jsxs("div",{className:"bg-gray-50 p-4 flex flex-col justify-center items-center rounded-xl",children:[e.jsx(O,{className:"text-4xl text-blue-500"}),e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"Time Taken"}),e.jsxs("h3",{className:"text-xl font-bold",children:[S,"s"]})]})]}),e.jsxs("div",{className:"flex justify-center gap-4 mb-10 flex-wrap",children:[e.jsx("button",{onClick:()=>p("/student/progress"),className:"px-6 py-2 border border-blue-500 text-blue-600 rounded-3xl hover:bg-blue-50",children:"View Progress"}),e.jsx("button",{className:"px-6 py-2 border border-green-500 text-green-600 rounded-3xl hover:bg-green-50",children:"View Certificates"}),e.jsx("button",{onClick:()=>p("/student/assessment"),className:"px-6 py-2 border border-blue-500 text-blue-600 rounded-3xl hover:bg-blue-50",children:"Done"})]}),e.jsxs("div",{className:"text-left",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Question Review"}),e.jsx("div",{className:"space-y-4",children:l.map((s,t)=>{const r=i[t]===s.answer;return e.jsxs("div",{className:`p-4 border rounded-xl ${r?"border-green-300 bg-green-50":"border-red-300 bg-red-50"}`,children:[e.jsxs("h4",{className:"font-medium mb-2",children:["Question ",t+1,": ",s.question]}),e.jsx("p",{className:"text-sm",children:r?e.jsx("span",{className:"text-green-700 font-medium",children:"✅ Correct"}):e.jsx("span",{className:"text-red-700 font-medium",children:"❌ Incorrect"})}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Correct answer:"," ",e.jsx("span",{className:"font-semibold text-gray-800",children:s.answer})]})]},s.id)})})]})]}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"quiz-cover flex pt-10 flex-col justify-center w-full md:w-3/4 lg:w-1/2 mx-auto items-center gap-4",children:[e.jsxs("div",{className:"quize-top w-full rounded-2xl border-2 shadow-md border-gray-200 p-4 bg-white",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h2",{className:"text-lg font-semibold",children:N}),e.jsxs("div",{className:"px-4 py-1 bg-red-100 text-red-700 rounded-full text-sm font-semibold flex items-center gap-2",children:["⏳",e.jsxs("span",{children:[String(Math.floor(x/60)).padStart(2,"0"),":",String(x%60).padStart(2,"0")]})]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Question ",a+1," of ",o]})]}),e.jsx("div",{className:"h-2 w-full bg-gray-200 rounded-full overflow-hidden mb-6",children:e.jsx("div",{className:"h-full bg-blue-600 transition-all duration-500",style:{width:`${L}%`}})}),e.jsxs("div",{className:"quiz-q",children:[e.jsx("h3",{className:"text-xl font-medium mb-5",children:l[a].question}),e.jsx("div",{className:"space-y-4",children:l[a].options.map((s,t)=>{const r=i[a]===s,c=s===l[a].answer;return e.jsx("button",{onClick:()=>F(s),className:`w-full text-left border rounded-xl py-3 px-4 transition ${r?c?"border-green-500 bg-green-50 text-green-700":"border-red-500 bg-red-50 text-red-700":"border-gray-200 hover:border-blue-400"}`,children:s},t)})})]}),e.jsxs("div",{className:"flex justify-between items-center mt-8",children:[e.jsx("button",{onClick:q,disabled:a===0,className:`px-5 py-2 rounded-3xl ${a===0?"bg-gray-200 text-gray-400 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"}`,children:"Previous"}),e.jsxs("p",{className:"text-md font-medium text-gray-700",children:["✅ Answered:"," ",e.jsx("span",{className:"text-blue-600",children:v})," /"," ",o]}),e.jsx("button",{onClick:I,className:"px-5 py-2 rounded-3xl text-white bg-blue-600 hover:bg-blue-700",children:a===o-1?"Finish":"Next"})]})]}),e.jsxs("div",{className:"quiz-bot w-full rounded-2xl border-2 border-gray-200 p-4 shadow-md bg-white flex flex-col items-center",children:[e.jsx("h3",{className:"font-medium mb-3",children:"Question Navigator"}),e.jsx("div",{className:"flex gap-3 flex-wrap justify-center items-center",children:l.map((s,t)=>e.jsx("button",{onClick:()=>b(t),className:`w-10 h-10 lg:w-12 lg:h-12 rounded-2xl text-sm font-medium ${a===t?"bg-blue-600 text-white":i[t]?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700 hover:bg-blue-50"}`,children:t+1},s.id))})]})]})})]})}):e.jsx("div",{className:"flex justify-center items-center min-h-screen text-gray-600 text-lg",children:"No questions found for this assessment ❌"})}export{se as default};
