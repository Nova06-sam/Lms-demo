import{b as me,r as u,j as e,L as ke,u as Pe}from"./index-BAzVzJec.js";import{a as V}from"./index-B9ygI19o.js";import{j as $e,t as ge,u as ve}from"./index-BoJ_87Vx.js";import{b as Te,c as Le,d as Ie,e as Re,f as De,g as Ae,h as Me}from"./index-D9b6Bac8.js";import{H as Oe}from"./index-CzwuvtqY.js";import{c as We}from"./index-DaWSInqW.js";import{L as Ue}from"./index-BuVtVerl.js";import{a as Fe}from"./index-HLd47iGM.js";import"./iconBase-CAFTq8Rg.js";function Be({data:a,onLessonClick:o}){const{courseId:n}=me(),[c,p]=u.useState([]),[d,v]=u.useState(0),[y,h]=u.useState(0),k=d===0?0:Math.round(y/d*100),[b,P]=u.useState({});u.useEffect(()=>{(async()=>{try{const _=await V.get(`http://localhost:5000/api/courses/${n}`);p(_.data.chapters),v(_.data.chapters.length),_.data.chapters.forEach(S=>{S.lessonVideoURL&&$(S.lessonVideoURL,m=>{P(x=>({...x,[S._id]:m}))})})}catch(_){console.log(`Error fetching in VideoSidebar: ${_}`)}})()},[n]);const g=w=>{console.log("Clicked lesson ID:",w),o(w)},$=(w,_)=>{const S=document.createElement("video");S.src=w,S.preload="metadata",S.onloadedmetadata=()=>{const m=(S.duration/60).toFixed(2);_(m)},S.onerror=()=>_(null)};return e.jsxs("div",{className:"p-6",children:[e.jsx(ke,{onClick:()=>window.history.back(),className:"mb-4 hover:bg-green-400 text-lg rounded-full p-2 w-50 -ml-5 -mt-2.5",children:"← Back to Course"}),e.jsx("h2",{className:"text-lg font-bold mb-4",children:"Course Progress"}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsxs("span",{children:[y," of ",d," lessons completed"]}),e.jsxs("span",{children:[k,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:`${k}%`}})})]}),e.jsx("ul",{className:"space-y-2",children:c.map(w=>e.jsxs("li",{onClick:()=>g(w._id),className:"flex items-center justify-between p-2 rounded-lg cursor-pointer hover:bg-blue-50",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:w.lessonName}),e.jsx("p",{className:"text-xs text-gray-400",children:b[w._id]?`${b[w._id]} min`:"Loading..."})]}),e.jsx("video",{src:w.lessonVideoURL,preload:"metadata",className:"hidden",crossOrigin:"anonymous",onLoadedMetadata:_=>{const m=(_.target.duration/60).toFixed(2);P(x=>({...x,[w._id]:m}))}}),w.completed&&e.jsx($e,{className:"text-green-500"})]},w._id))})]})}function Ge({activeTab:a,setActiveTab:o}){const n=["notes","resources","assignments","discussion"];return e.jsx("div",{className:"flex gap-4 mb-4 border-b",children:n.map(c=>e.jsx("button",{onClick:()=>o(c),className:`pb-2 capitalize font-medium ${a===c?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-blue-500"}`,children:c},c))})}function xe({title:a,subtitle:o,videoUrl:n,studentId:c,videoId:p,courseId:d}){const v=u.useRef(null);return e.jsxs("div",{className:"video-section pb-10",children:[e.jsx("h2",{children:a}),e.jsx("p",{children:o}),e.jsx("video",{className:" w-full pt-5",controls:!0,src:n,ref:v,controlsList:"nodownload noremoteplayback",disablePictureInPicture:!0,onContextMenu:y=>y.preventDefault()})]})}function be(a,o,n,c,p,d,v){try{var y=a[d](v),h=y.value}catch(k){n(k);return}y.done?o(h):Promise.resolve(h).then(c,p)}function Ve(a){return function(){var o=this,n=arguments;return new Promise(function(c,p){var d=a.apply(o,n);function v(h){be(d,c,p,v,y,"next",h)}function y(h){be(d,c,p,v,y,"throw",h)}v(void 0)})}}function ne(){return ne=Object.assign||function(a){for(var o=1;o<arguments.length;o++){var n=arguments[o];for(var c in n)Object.prototype.hasOwnProperty.call(n,c)&&(a[c]=n[c])}return a},ne.apply(this,arguments)}var Ne={exports:{}};(function(a){var o=(function(n){var c=Object.prototype,p=c.hasOwnProperty,d,v=typeof Symbol=="function"?Symbol:{},y=v.iterator||"@@iterator",h=v.asyncIterator||"@@asyncIterator",k=v.toStringTag||"@@toStringTag";function b(r,t,i){return Object.defineProperty(r,t,{value:i,enumerable:!0,configurable:!0,writable:!0}),r[t]}try{b({},"")}catch{b=function(t,i,l){return t[i]=l}}function P(r,t,i,l){var s=t&&t.prototype instanceof x?t:x,j=Object.create(s.prototype),L=new se(l||[]);return j._invoke=oe(r,i,L),j}n.wrap=P;function g(r,t,i){try{return{type:"normal",arg:r.call(t,i)}}catch(l){return{type:"throw",arg:l}}}var $="suspendedStart",w="suspendedYield",_="executing",S="completed",m={};function x(){}function N(){}function f(){}var T={};b(T,y,function(){return this});var F=Object.getPrototypeOf,X=F&&F(F(Z([])));X&&X!==c&&p.call(X,y)&&(T=X);var W=f.prototype=x.prototype=Object.create(T);N.prototype=f,b(W,"constructor",f),b(f,"constructor",N),N.displayName=b(f,k,"GeneratorFunction");function te(r){["next","throw","return"].forEach(function(t){b(r,t,function(i){return this._invoke(t,i)})})}n.isGeneratorFunction=function(r){var t=typeof r=="function"&&r.constructor;return t?t===N||(t.displayName||t.name)==="GeneratorFunction":!1},n.mark=function(r){return Object.setPrototypeOf?Object.setPrototypeOf(r,f):(r.__proto__=f,b(r,k,"GeneratorFunction")),r.prototype=Object.create(W),r},n.awrap=function(r){return{__await:r}};function J(r,t){function i(j,L,E,D){var I=g(r[j],r,L);if(I.type==="throw")D(I.arg);else{var B=I.arg,M=B.value;return M&&typeof M=="object"&&p.call(M,"__await")?t.resolve(M.__await).then(function(G){i("next",G,E,D)},function(G){i("throw",G,E,D)}):t.resolve(M).then(function(G){B.value=G,E(B)},function(G){return i("throw",G,E,D)})}}var l;function s(j,L){function E(){return new t(function(D,I){i(j,L,D,I)})}return l=l?l.then(E,E):E()}this._invoke=s}te(J.prototype),b(J.prototype,h,function(){return this}),n.AsyncIterator=J,n.async=function(r,t,i,l,s){s===void 0&&(s=Promise);var j=new J(P(r,t,i,l),s);return n.isGeneratorFunction(t)?j:j.next().then(function(L){return L.done?L.value:j.next()})};function oe(r,t,i){var l=$;return function(j,L){if(l===_)throw new Error("Generator is already running");if(l===S){if(j==="throw")throw L;return K()}for(i.method=j,i.arg=L;;){var E=i.delegate;if(E){var D=re(E,i);if(D){if(D===m)continue;return D}}if(i.method==="next")i.sent=i._sent=i.arg;else if(i.method==="throw"){if(l===$)throw l=S,i.arg;i.dispatchException(i.arg)}else i.method==="return"&&i.abrupt("return",i.arg);l=_;var I=g(r,t,i);if(I.type==="normal"){if(l=i.done?S:w,I.arg===m)continue;return{value:I.arg,done:i.done}}else I.type==="throw"&&(l=S,i.method="throw",i.arg=I.arg)}}}function re(r,t){var i=r.iterator[t.method];if(i===d){if(t.delegate=null,t.method==="throw"){if(r.iterator.return&&(t.method="return",t.arg=d,re(r,t),t.method==="throw"))return m;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return m}var l=g(i,r.iterator,t.arg);if(l.type==="throw")return t.method="throw",t.arg=l.arg,t.delegate=null,m;var s=l.arg;if(!s)return t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,m;if(s.done)t[r.resultName]=s.value,t.next=r.nextLoc,t.method!=="return"&&(t.method="next",t.arg=d);else return s;return t.delegate=null,m}te(W),b(W,k,"Generator"),b(W,y,function(){return this}),b(W,"toString",function(){return"[object Generator]"});function Q(r){var t={tryLoc:r[0]};1 in r&&(t.catchLoc=r[1]),2 in r&&(t.finallyLoc=r[2],t.afterLoc=r[3]),this.tryEntries.push(t)}function q(r){var t=r.completion||{};t.type="normal",delete t.arg,r.completion=t}function se(r){this.tryEntries=[{tryLoc:"root"}],r.forEach(Q,this),this.reset(!0)}n.keys=function(r){var t=[];for(var i in r)t.push(i);return t.reverse(),function l(){for(;t.length;){var s=t.pop();if(s in r)return l.value=s,l.done=!1,l}return l.done=!0,l}};function Z(r){if(r){var t=r[y];if(t)return t.call(r);if(typeof r.next=="function")return r;if(!isNaN(r.length)){var i=-1,l=function s(){for(;++i<r.length;)if(p.call(r,i))return s.value=r[i],s.done=!1,s;return s.value=d,s.done=!0,s};return l.next=l}}return{next:K}}n.values=Z;function K(){return{value:d,done:!0}}return se.prototype={constructor:se,reset:function(r){if(this.prev=0,this.next=0,this.sent=this._sent=d,this.done=!1,this.delegate=null,this.method="next",this.arg=d,this.tryEntries.forEach(q),!r)for(var t in this)t.charAt(0)==="t"&&p.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=d)},stop:function(){this.done=!0;var r=this.tryEntries[0],t=r.completion;if(t.type==="throw")throw t.arg;return this.rval},dispatchException:function(r){if(this.done)throw r;var t=this;function i(D,I){return j.type="throw",j.arg=r,t.next=D,I&&(t.method="next",t.arg=d),!!I}for(var l=this.tryEntries.length-1;l>=0;--l){var s=this.tryEntries[l],j=s.completion;if(s.tryLoc==="root")return i("end");if(s.tryLoc<=this.prev){var L=p.call(s,"catchLoc"),E=p.call(s,"finallyLoc");if(L&&E){if(this.prev<s.catchLoc)return i(s.catchLoc,!0);if(this.prev<s.finallyLoc)return i(s.finallyLoc)}else if(L){if(this.prev<s.catchLoc)return i(s.catchLoc,!0)}else if(E){if(this.prev<s.finallyLoc)return i(s.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(r,t){for(var i=this.tryEntries.length-1;i>=0;--i){var l=this.tryEntries[i];if(l.tryLoc<=this.prev&&p.call(l,"finallyLoc")&&this.prev<l.finallyLoc){var s=l;break}}s&&(r==="break"||r==="continue")&&s.tryLoc<=t&&t<=s.finallyLoc&&(s=null);var j=s?s.completion:{};return j.type=r,j.arg=t,s?(this.method="next",this.next=s.finallyLoc,m):this.complete(j)},complete:function(r,t){if(r.type==="throw")throw r.arg;return r.type==="break"||r.type==="continue"?this.next=r.arg:r.type==="return"?(this.rval=this.arg=r.arg,this.method="return",this.next="end"):r.type==="normal"&&t&&(this.next=t),m},finish:function(r){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.finallyLoc===r)return this.complete(i.completion,i.afterLoc),q(i),m}},catch:function(r){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.tryLoc===r){var l=i.completion;if(l.type==="throw"){var s=l.arg;q(i)}return s}}throw new Error("illegal catch attempt")},delegateYield:function(r,t,i){return this.delegate={iterator:Z(r),resultName:t,nextLoc:i},this.method==="next"&&(this.arg=d),m}},n})(a.exports);try{regeneratorRuntime=o}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=o:Function("r","regeneratorRuntime = r")(o)}})(Ne);var ye=Ne.exports,Se=function(o){var n=o.paths,c=o.id,p=o.strokeWidth,d=o.strokeColor,v=o.command,y=v===void 0?_e:v;if(n.length===1){var h=n[0],k=h.x,b=h.y,P=p/2;return u.createElement("circle",{key:c,id:c,cx:k,cy:b,r:P,stroke:d,fill:d})}var g=n.reduce(function($,w,_,S){return _===0?"M "+w.x+","+w.y:$+" "+y(w,_,S)},"");return u.createElement("path",{key:c,id:c,d:g,fill:"none",strokeLinecap:"round",stroke:d,strokeWidth:p})},ze=function(o,n){var c=n.x-o.x,p=n.y-o.y;return{length:Math.sqrt(Math.pow(c,2)+Math.pow(p,2)),angle:Math.atan2(p,c)}},he=function(o){var n=o.current,c=o.next,p=o.previous,d=o.reverse,v=p||n,y=c||n,h=.2,k=ze(v,y),b=k.angle+(d?Math.PI:0),P=k.length*h,g=n.x+Math.cos(b)*P,$=n.y+Math.sin(b)*P;return[g,$]},_e=function(o,n,c){var p=null,d=null;switch(n){case 0:var v=he({current:o});p=v[0],d=v[1];break;case 1:var y=he({current:c[n-1],next:o});p=y[0],d=y[1];break;default:var h=he({current:c[n-1],previous:c[n-2],next:o});p=h[0],d=h[1];break}var k=he({current:o,previous:c[n-1],next:c[n+1],reverse:!0}),b=k[0],P=k[1];return"C "+p+","+d+" "+b+","+P+" "+o.x+", "+o.y},He=function(o){var n=o.id,c=o.paths;return u.createElement(u.Fragment,null,c.map(function(p,d){return u.createElement(Se,{key:n+"__"+d,paths:p.paths,id:n+"__"+d,strokeWidth:p.strokeWidth,strokeColor:p.strokeColor,command:_e})}))},we=function(o){return new Promise(function(n,c){var p=new Image;p.addEventListener("load",function(){p.width>0&&n(p),c("Image not found")}),p.addEventListener("error",function(d){return c(d)}),p.src=o,p.setAttribute("crossorigin","anonymous")})};function je(a){var o,n=(o=a.firstChild)==null?void 0:o.cloneNode(!0),c=a.offsetWidth,p=a.offsetHeight;return n.setAttribute("viewBox","0 0 "+c+" "+p),n.setAttribute("width",c.toString()),n.setAttribute("height",p.toString()),{svgCanvas:n,width:c,height:p}}var Ye=u.forwardRef(function(a,o){var n=a.paths,c=a.isDrawing,p=a.onPointerDown,d=a.onPointerMove,v=a.onPointerUp,y=a.id,h=y===void 0?"react-sketch-canvas":y,k=a.width,b=k===void 0?"100%":k,P=a.height,g=P===void 0?"100%":P,$=a.className,w=$===void 0?"react-sketch-canvas":$,_=a.canvasColor,S=_===void 0?"red":_,m=a.backgroundImage,x=m===void 0?"":m,N=a.exportWithBackgroundImage,f=N===void 0?!1:N,T=a.preserveBackgroundImageAspectRatio,F=T===void 0?"none":T,X=a.allowOnlyPointerType,W=X===void 0?"all":X,te=a.style,J=te===void 0?{border:"0.0625rem solid #9c9c9c",borderRadius:"0.25rem"}:te,oe=a.svgStyle,re=oe===void 0?{}:oe,Q=u.useRef(null),q=function(s){var j,L,E,D=(j=Q.current)==null?void 0:j.getBoundingClientRect(),I=(L=window.scrollX)!=null?L:0,B=(E=window.scrollY)!=null?E:0;if(!D)return{x:0,y:0};var M={x:s.pageX-D.left-I,y:s.pageY-D.top-B};return M},se=function(s){if(!(W!=="all"&&s.pointerType!==W)&&!(s.pointerType==="mouse"&&s.button!==0)){var j=q(s);p(j)}},Z=function(s){if(c&&!(W!=="all"&&s.pointerType!==W)){var j=q(s);d(j)}},K=function(s){s.pointerType==="mouse"&&s.button!==0||W!=="all"&&s.pointerType!==W||v()};u.useImperativeHandle(o,function(){return{exportImage:function(s){return new Promise((function(){var j=Ve(ye.mark(function L(E,D){var I,B,M,G,ce,ae,ie,z;return ye.wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(A.prev=0,I=Q.current,I){A.next=4;break}throw Error("Canvas not rendered yet");case 4:return B=je(I),M=B.svgCanvas,G=B.width,ce=B.height,ae="data:image/svg+xml;base64,"+btoa(M.outerHTML),A.next=8,we(ae);case 8:if(A.t0=A.sent,ie=[A.t0],!f){A.next=21;break}return A.prev=11,A.next=14,we(x);case 14:z=A.sent,ie.push(z),A.next=21;break;case 18:A.prev=18,A.t1=A.catch(11),console.warn("exportWithBackgroundImage props is set without a valid background image URL. This option is ignored");case 21:Promise.all(ie).then(function(de){var le=document.createElement("canvas");le.setAttribute("width",G.toString()),le.setAttribute("height",ce.toString());var ue=le.getContext("2d");if(!ue)throw Error("Canvas not rendered yet");de.reverse().forEach(function(O){ue.drawImage(O,0,0)}),E(le.toDataURL("image/"+s))}).catch(function(de){throw de}),A.next=27;break;case 24:A.prev=24,A.t2=A.catch(0),D(A.t2);case 27:case"end":return A.stop()}},L,null,[[0,24],[11,18]])}));return function(L,E){return j.apply(this,arguments)}})())},exportSvg:function(){return new Promise(function(s,j){try{var L,E=(L=Q.current)!=null?L:null;if(E!==null){var D,I,B=je(E),M=B.svgCanvas;if(f){s(M.outerHTML);return}(D=M.querySelector("#"+h+"__background"))==null||D.remove(),(I=M.querySelector("#"+h+"__canvas-background"))==null||I.setAttribute("fill",S),s(M.outerHTML)}j(new Error("Canvas not loaded"))}catch(G){j(G)}})}}}),u.useEffect(function(){return document.addEventListener("pointerup",K),function(){document.removeEventListener("pointerup",K)}},[K]);var r=n.filter(function(l){return!l.drawMode}),t=0,i=n.reduce(function(l,s){return s.drawMode?(l[t]===void 0&&(l[t]=[]),l[t].push(s),l):(t+=1,l)},[[]]);return u.createElement("div",{role:"presentation",ref:Q,className:w,style:ne({touchAction:"none",width:b,height:g},J),"touch-action":"none",onPointerDown:se,onPointerMove:Z,onPointerUp:K},u.createElement("svg",{version:"1.1",baseProfile:"full",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",style:ne({width:"100%",height:"100%"},re),id:h},u.createElement("g",{id:h+"__eraser-stroke-group",display:"none"},u.createElement("rect",{id:h+"__mask-background",x:"0",y:"0",width:"100%",height:"100%",fill:"white"}),r.map(function(l,s){return u.createElement(Se,{key:h+"__eraser-"+s,id:h+"__eraser-"+s,paths:l.paths,strokeColor:"#000000",strokeWidth:l.strokeWidth})})),u.createElement("defs",null,x&&u.createElement("pattern",{id:h+"__background",x:"0",y:"0",width:"100%",height:"100%",patternUnits:"userSpaceOnUse"},u.createElement("image",{x:"0",y:"0",width:"100%",height:"100%",xlinkHref:x,preserveAspectRatio:F})),r.map(function(l,s){return u.createElement("mask",{id:h+"__eraser-mask-"+s,key:h+"__eraser-mask-"+s,maskUnits:"userSpaceOnUse"},u.createElement("use",{href:"#"+h+"__mask-background"}),Array.from({length:r.length-s},function(j,L){return L+s}).map(function(j){return u.createElement("use",{key:j.toString(),href:"#"+h+"__eraser-"+j.toString()})}))})),u.createElement("g",{id:h+"__canvas-background-group"},u.createElement("rect",{id:h+"__canvas-background",x:"0",y:"0",width:"100%",height:"100%",fill:x?"url(#"+h+"__background)":S})),i.map(function(l,s){return u.createElement("g",{id:h+"__stroke-group-"+s,key:h+"__stroke-group-"+s,mask:"url(#"+h+"__eraser-mask-"+s+")"},u.createElement(He,{id:h,paths:l}))})))}),Xe=u.forwardRef(function(a,o){var n=a.id,c=n===void 0?"react-sketch-canvas":n,p=a.width,d=p===void 0?"100%":p,v=a.height,y=v===void 0?"100%":v,h=a.className,k=h===void 0?"":h,b=a.canvasColor,P=b===void 0?"white":b,g=a.strokeColor,$=g===void 0?"red":g,w=a.backgroundImage,_=w===void 0?"":w,S=a.exportWithBackgroundImage,m=S===void 0?!1:S,x=a.preserveBackgroundImageAspectRatio,N=x===void 0?"none":x,f=a.strokeWidth,T=f===void 0?4:f,F=a.eraserWidth,X=F===void 0?8:F,W=a.allowOnlyPointerType,te=W===void 0?"all":W,J=a.style,oe=J===void 0?{border:"0.0625rem solid #9c9c9c",borderRadius:"0.25rem"}:J,re=a.svgStyle,Q=re===void 0?{}:re,q=a.onChange,se=q===void 0?function(O){}:q,Z=a.onStroke,K=Z===void 0?function(O,C){}:Z,r=a.withTimestamp,t=r===void 0?!1:r,i=u.createRef(),l=u.useState(!0),s=l[0],j=l[1],L=u.useState(!1),E=L[0],D=L[1],I=u.useState([]),B=I[0],M=I[1],G=u.useState([]),ce=G[0],ae=G[1],ie=u.useState([]),z=ie[0],H=ie[1],A=u.useCallback(function(){var O,C,R=(O=(C=z.slice(-1))==null?void 0:C[0])!=null?O:null;if(R===null){console.warn("No stroke found!");return}K(R,!R.drawMode)},[E]);u.useEffect(function(){A()},[E]),u.useEffect(function(){se(z)},[z]),u.useImperativeHandle(o,function(){return{eraseMode:function(C){j(!C)},clearCanvas:function(){M([].concat(z)),H([])},undo:function(){if(B.length!==0){H([].concat(B)),M([]);return}ae(function(C){return[].concat(C,z.slice(-1))}),H(function(C){return C.slice(0,-1)})},redo:function(){ce.length!==0&&(H(function(C){return[].concat(C,ce.slice(-1))}),ae(function(C){return C.slice(0,-1)}))},exportImage:function(C){var R,U=(R=i.current)==null?void 0:R.exportImage;if(U)return U(C);throw Error("Export function called before canvas loaded")},exportSvg:function(){return new Promise(function(C,R){var U,Y=(U=i.current)==null?void 0:U.exportSvg;Y?Y().then(function(ee){C(ee)}).catch(function(ee){R(ee)}):R(Error("Export function called before canvas loaded"))})},exportPaths:function(){return new Promise(function(C,R){try{C(z)}catch(U){R(U)}})},loadPaths:function(C){H(function(R){return[].concat(R,C)})},getSketchingTime:function(){return new Promise(function(C,R){t||R(new Error("Set 'withTimestamp' prop to get sketching time"));try{var U=z.reduce(function(Y,ee){var pe,fe,Ce=(pe=ee.startTimestamp)!=null?pe:0,Ee=(fe=ee.endTimestamp)!=null?fe:0;return Y+(Ee-Ce)},0);C(U)}catch(Y){R(Y)}})},resetCanvas:function(){M([]),ae([]),H([])}}});var de=function(C){D(!0),ae([]);var R={drawMode:s,strokeColor:s?$:"#000000",strokeWidth:s?T:X,paths:[C]};t&&(R=ne({},R,{startTimestamp:Date.now(),endTimestamp:0})),H(function(U){return[].concat(U,[R])})},le=function(C){if(E){var R=z.slice(-1)[0],U=ne({},R,{paths:[].concat(R.paths,[C])});H(function(Y){return[].concat(Y.slice(0,-1),[U])})}},ue=function(){var C,R;if(E&&(D(!1),!!t)){var U=(C=(R=z.slice(-1))==null?void 0:R[0])!=null?C:null;if(U!==null){var Y=ne({},U,{endTimestamp:Date.now()});H(function(ee){return[].concat(ee.slice(0,-1),[Y])})}}};return u.createElement(Ye,{ref:i,id:c,width:d,height:y,className:k,canvasColor:P,backgroundImage:_,exportWithBackgroundImage:m,preserveBackgroundImageAspectRatio:N,allowOnlyPointerType:te,style:oe,svgStyle:Q,paths:z,isDrawing:E,onPointerDown:de,onPointerMove:le,onPointerUp:ue})});function Je({courseId:a,lessonId:o}){const n=JSON.parse(localStorage.getItem("user")),[c,p]=u.useState(""),[d,v]=u.useState([]),[y,h]=u.useState(!1),[k,b]=u.useState(null),[P,g]=u.useState(""),$=u.useRef(null);u.useEffect(()=>{(async()=>{try{if(!n?._id||!a)return;const T=await V.post("http://localhost:5000/api/videonotes/fetch",{studentId:n._id,courseId:a,lessonId:o});T.data.success&&v(T.data.data)}catch(T){console.error("Error fetching video notes:",T)}})()},[a,o]);const w=async()=>{if(c.trim())try{const f=await V.post("http://localhost:5000/api/videonotes",{studentId:n._id,courseId:a,lessonId:o||null,text:c.trim()});f.data.success&&(v([f.data.data,...d]),p(""))}catch(f){console.error("Error saving text note:",f)}},_=async()=>{try{const f=await $.current.exportImage("png"),T=await V.post("http://localhost:5000/api/videonotes",{studentId:n._id,courseId:a,lessonId:o||null,sketch:f});T.data.success&&(v([T.data.data,...d]),$.current.clearCanvas(),h(!1))}catch(f){console.error("Error saving sketch:",f)}},S=async f=>{if(window.confirm("Delete this note?"))try{(await V.delete(`http://localhost:5000/api/videonotes/${f}`)).data.success&&v(d.filter(F=>F._id!==f))}catch(T){console.error("Error deleting note:",T)}},m=f=>{b(f._id),g(f.text)},x=()=>{b(null),g("")},N=async f=>{if(P.trim())try{const T=await V.put(`http://localhost:5000/api/videonotes/${f}`,{text:P});T.data.success&&(v(d.map(F=>F._id===f?T.data.data:F)),b(null),g(""))}catch(T){console.error("Error updating note:",T)}};return e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Lesson Notes"}),e.jsxs("button",{onClick:()=>h(!y),className:"flex items-center gap-2 bg-blue-600 text-white px-3 py-1.5 rounded-lg hover:bg-blue-700 transition",children:[e.jsx(Te,{}),y?"Text Mode":"Sketch Mode"]})]}),y?e.jsxs("div",{children:[e.jsx(Xe,{ref:$,width:"100%",height:"300px",strokeWidth:3,strokeColor:"black",className:"border rounded-lg mb-3"}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("button",{onClick:()=>$.current.clearCanvas(),className:"text-sm border border-gray-400 rounded-lg px-3 py-1 text-gray-700 hover:bg-gray-100",children:"Clear"}),e.jsx("button",{onClick:_,className:"text-sm bg-green-600 text-white rounded-lg px-4 py-1 hover:bg-green-700",children:"Save Sketch"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("textarea",{value:c,onChange:f=>p(f.target.value),placeholder:"Write your notes here...",className:"w-full p-3 border rounded-lg mb-2 h-24 resize-none focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("p",{className:"text-xs text-gray-400",children:"Your notes are stored securely"}),e.jsx("button",{onClick:w,className:"bg-blue-600 text-white px-4 py-1.5 rounded-lg hover:bg-blue-700 transition",children:"Save Note"})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"text-sm font-semibold mb-3 text-gray-700",children:"My Notes"}),d.length===0?e.jsx("p",{className:"text-gray-500 text-sm",children:"No notes yet for this course."}):d.map(f=>e.jsxs("div",{className:"bg-gray-100 rounded-lg p-3 mb-3 flex justify-between items-start",children:[e.jsx("div",{className:"flex-1 mr-3",children:f.sketch?e.jsx("img",{src:f.sketch,alt:"Sketch",className:"rounded-lg border mb-2 w-full"}):k===f._id?e.jsxs(e.Fragment,{children:[e.jsx("textarea",{value:P,onChange:T=>g(T.target.value),className:"w-full border rounded-lg p-2 mb-2 text-sm"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>N(f._id),className:"flex items-center gap-1 text-green-600 border border-green-500 px-3 py-1 rounded-lg text-sm hover:bg-green-50",children:[e.jsx(Le,{})," Save"]}),e.jsxs("button",{onClick:x,className:"flex items-center gap-1 text-gray-600 border border-gray-400 px-3 py-1 rounded-lg text-sm hover:bg-gray-50",children:[e.jsx(Ie,{})," Cancel"]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm mb-2",children:f.text}),e.jsx("p",{className:"text-xs text-gray-400",children:new Date(f.createdAt).toLocaleString()})]})}),e.jsxs("div",{className:"flex flex-col gap-2 items-center",children:[!f.sketch&&k!==f._id&&e.jsx("button",{onClick:()=>m(f),className:"text-blue-500 hover:text-blue-700",title:"Edit",children:e.jsx(Re,{})}),e.jsx("button",{onClick:()=>S(f._id),className:"text-red-500 hover:text-red-700",title:"Delete",children:e.jsx(De,{})})]})]},f._id))]})]})}function qe({pdfs:a=[]}){return e.jsxs("div",{className:"p-8 bg-gray-50",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Course Resources"}),a.length===0?e.jsx("p",{className:"text-gray-500",children:"No resources available for this lesson."}):e.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:a.map((o,n)=>e.jsxs("div",{className:"flex items-center justify-between bg-white rounded-2xl shadow-sm p-5 hover:shadow-md transition-all",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-blue-50 rounded-full",children:e.jsx(Oe,{className:"text-blue-500 text-2xl"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-800",children:o.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[(o.size/1024).toFixed(1)," KB"]})]})]}),e.jsx("a",{href:o.url,target:"_blank",rel:"noopener noreferrer",className:"p-2 hover:bg-gray-100 rounded-full transition",children:e.jsx(Ae,{className:"text-gray-600 text-lg"})})]},n))})]})}function Ke({courseTitle:a}){Pe();const[o,n]=u.useState("Available"),[c,p]=u.useState([]),[d,v]=u.useState(null),[y,h]=u.useState({});u.useEffect(()=>{(async()=>{try{const $=JSON.parse(localStorage.getItem("user")),w=await V.post("http://localhost:5000/api/assessments/course/student",{courseTitle:a,studentId:$._id});if(w.data.success){const _=[...w.data.completed.map(S=>({...S,status:"completed"})),...w.data.pending.map(S=>({...S,status:"published"}))];p(_),h({total:w.data.total,completed:w.data.completedCount,pending:w.data.pendingCount})}console.log(w.data)}catch($){console.error("Error fetching student course assignments:",$)}})()},[a]);const k=async(g,$,w)=>{const _=g.target.files[0];if(!_)return;if(!["application/pdf","text/plain","application/zip"].includes(_.type)){alert("Please upload only .pdf, .txt, or .zip files");return}const m=JSON.parse(localStorage.getItem("user")),x=new FormData;x.append("file",_),x.append("studentId",m?._id),x.append("studentName",m?.name||"Unknown"),x.append("studentEmail",m?.email||"unknown@gmail.com"),x.append("assessmentId",$),x.append("assessmentType",w);try{(await V.post("http://localhost:5000/api/submissions/upload",x,{headers:{"Content-Type":"multipart/form-data"}})).data.success?(alert("✅ File uploaded successfully!"),window.location.reload()):alert("❌ Upload failed, please try again.")}catch(N){console.error("Upload error:",N),alert("Error uploading file.")}},b=[{label:"Available",status:"published"},{label:"Completed",status:"completed"}],P=c.filter(g=>o==="Available"&&g.status==="published"||o==="Completed"&&g.status==="completed");return e.jsxs("div",{className:"p-5 sm:p-10 bg-gray-100 min-h-screen",children:[e.jsxs("div",{className:"flex gap-6 mb-6 text-gray-700",children:[e.jsxs("p",{children:["Total: ",e.jsx("b",{children:y.total||0})]}),e.jsxs("p",{children:["Completed: ",e.jsx("b",{className:"text-green-600",children:y.completed||0})]}),e.jsxs("p",{children:["Pending: ",e.jsx("b",{className:"text-yellow-600",children:y.pending||0})]})]}),e.jsx("div",{className:"Filter-Buttons flex flex-wrap gap-2 sm:gap-4 mt-4 bg-gray-200 rounded-full w-fit px-3 py-2",children:b.map(g=>e.jsx("button",{onClick:()=>n(g.label),className:`btn rounded-full px-5 py-1.5 text-sm sm:text-base font-medium transition ${o===g.label?"bg-white shadow-md":"hover:bg-white"}`,children:g.label},g.label))}),e.jsx("div",{className:"mt-6 space-y-5",children:P.length===0?e.jsx("p",{className:"text-gray-500",children:"No assessments found for this category."}):P.map(g=>e.jsx("div",{className:"p-5 sm:p-7 bg-white rounded-xl shadow-sm hover:shadow-md",children:e.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-3 shadow-xl rounded-2xl text-2xl text-white bg-blue-500",children:e.jsx(Ue,{})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg sm:text-xl font-semibold",children:g.title}),e.jsx("p",{className:"text-gray-600 text-sm sm:text-base",children:g.course})]})]}),o==="Available"&&e.jsxs("div",{className:"flex flex-wrap justify-start md:justify-end gap-3",children:[e.jsx("span",{className:"text-sm bg-green-400 rounded-full py-1 px-3 text-white mt-6",children:"Available"}),g.type==="MCQ"?e.jsxs(ke,{to:`/student/assessment/quiz/${g.id}`,className:"flex items-center gap-2 text-sm sm:text-base bg-blue-500 rounded-xl text-white px-4 py-1 hover:bg-blue-600",children:[e.jsx(We,{}),"Start Assessment"]}):(g.type==="Subjective"||g.type==="Coding")&&e.jsx("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-3",children:e.jsxs("div",{children:[e.jsxs("label",{htmlFor:`upload-${g.id}`,className:"block text-sm text-gray-600 mb-1",children:["Upload your ",g.type," answer:"]}),e.jsx("input",{id:`upload-${g.id}`,type:"file",accept:".pdf,.txt,.zip",onChange:$=>k($,g.id,g.type),className:"block w-full text-sm text-gray-700 bg-gray-50 border border-gray-300 rounded-lg p-2 cursor-pointer hover:border-blue-400 transition"})]})})]}),o==="Completed"&&e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Completed"}),e.jsx("button",{onClick:()=>v(g),className:"text-sm border border-gray-300 bg-gray-100 rounded-full px-4 py-1 mt-1 hover:bg-gray-200",children:"View Details"})]})]})},g.id))}),d&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50 overflow-auto",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-11/12 sm:w-2/3 lg:w-1/2 p-6 relative max-h-[90vh] overflow-y-auto",children:[e.jsx("button",{onClick:()=>v(null),className:"absolute top-3 right-3 text-gray-500 hover:text-black text-xl",children:"✖"}),e.jsx("h2",{className:"text-2xl font-semibold mb-2 text-blue-600",children:d.title}),e.jsx("p",{className:"text-gray-600 mb-4",children:d.course}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-4 text-sm mb-5",children:[e.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg border",children:[e.jsx("b",{children:"Type:"}),e.jsx("p",{children:d.type})]}),e.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg border",children:[e.jsx("b",{children:"Submitted:"}),e.jsx("p",{children:new Date(d.submittedAt).toLocaleString()})]}),d.percentage&&e.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg border",children:[e.jsx("b",{children:"Percentage:"}),e.jsxs("p",{children:[d.percentage,"%"]})]})]})]})})]})}function Qe({lessonId:a}){const{courseId:o}=me(),[n,c]=u.useState(new Set),[p,d]=u.useState([]),[v,y]=u.useState(""),[h,k]=u.useState(""),[b,P]=u.useState(null),g=JSON.parse(localStorage.getItem("user"));console.log(g),u.useEffect(()=>{(async()=>{if(a)try{const x=await V.get(`http://localhost:5000/api/discussion/${o}/${a}`);d(x.data.discussion||[])}catch(x){console.log("Error fetching discussion:",x)}})()},[a,o]);const $=async()=>{if(v.trim()!=="")try{const m=await V.post(`http://localhost:5000/api/discussion/${o}/${a}/comment`,{userName:g.name,userPhoto:g.photoURL,commentText:v});d(m.data.discussion),y("")}catch(m){console.log("Error adding comment:",m)}},w=async(m,x=null)=>{if(h.trim()!=="")try{const N=await V.post(`http://localhost:5000/api/discussion/${o}/${a}/${m}/reply`,{userName:g.name,userPhoto:g.photoURL,replyText:h,parentReplyId:x});d(N.data.discussion),k(""),P(null)}catch(N){console.log("Error adding reply:",N)}},_=async(m,x=null)=>{const N=x?`${m}-${x}`:m;if(n.has(N)){console.log("Already liked");return}try{const f=x?`http://localhost:5000/api/discussion/${o}/${a}/${m}/${x}/like`:`http://localhost:5000/api/discussion/${o}/${a}/${m}/like`;await V.patch(f),c(F=>new Set(F).add(N));const T=await V.get(`http://localhost:5000/api/discussion/${o}/${a}`);d(T.data.discussion)}catch(f){console.log("Error liking:",f)}},S=(m,x)=>m.map(N=>e.jsxs("div",{className:"ml-10 mt-3 border-l border-gray-200 pl-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("img",{src:N.userPhoto,alt:"avatar",className:"w-8 h-8 rounded-full object-cover"}),e.jsx("h4",{className:"font-medium text-gray-700 text-sm",children:N.userName}),e.jsx("span",{className:"text-xs text-gray-400",children:new Date(N.createdAt).toLocaleString()})]}),e.jsx("p",{className:"text-sm text-gray-700 mt-1",children:N.replyText}),e.jsxs("div",{className:"flex gap-4 mt-1 text-sm text-gray-500",children:[e.jsxs("button",{onClick:()=>_(x,N._id),className:"hover:text-blue-600 flex items-center gap-1",children:[e.jsx(ge,{})," ",N.likes]}),e.jsxs("button",{onClick:()=>P(N._id),className:"hover:text-blue-600 flex items-center gap-1",children:[e.jsx(ve,{})," Reply"]})]}),b===N._id&&e.jsxs("div",{className:"ml-6 mt-2",children:[e.jsx("textarea",{value:h,onChange:f=>k(f.target.value),placeholder:"Write a reply...",className:"w-full border rounded-xl p-2 text-sm"}),e.jsx("button",{onClick:()=>w(x,N._id),className:"bg-blue-600 text-white px-4 py-1 rounded-lg mt-2 text-sm",children:"Reply"})]}),N.replies?.length>0&&S(N.replies,x)]},N._id));return e.jsxs("div",{className:"p-6 bg-gray-50",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Discussion"}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-4 mb-5",children:[e.jsx("textarea",{placeholder:"Ask a question or share your thoughts...",className:"w-full border rounded-xl p-3 text-sm resize-none focus:ring-2 focus:ring-blue-400",rows:3,value:v,onChange:m=>y(m.target.value)}),e.jsx("div",{className:"flex justify-end mt-2",children:e.jsx("button",{onClick:$,className:"bg-blue-600 text-white px-5 py-2 rounded-lg text-sm",children:"Post"})})]}),e.jsx("div",{className:"space-y-5",children:p.map(m=>e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:m.userPhoto,alt:"avatar",className:"w-10 h-10 rounded-full object-cover"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-800",children:m.userName}),e.jsx("p",{className:"text-xs text-gray-500",children:new Date(m.createdAt).toLocaleString()})]})]}),e.jsx("p",{className:"text-gray-700 text-sm mt-2",children:m.commentText}),e.jsxs("div",{className:"flex gap-5 mt-3 text-gray-500 text-sm",children:[e.jsxs("button",{onClick:()=>_(m._id),className:"hover:text-blue-600 flex items-center gap-1",children:[e.jsx(ge,{})," ",m.likes]}),e.jsxs("button",{onClick:()=>P(m._id),className:"hover:text-blue-600 flex items-center gap-1",children:[e.jsx(ve,{})," Reply"]})]}),b===m._id&&e.jsxs("div",{className:"mt-3 ml-8",children:[e.jsx("textarea",{value:h,onChange:x=>k(x.target.value),placeholder:"Write a reply...",className:"w-full border rounded-xl p-2 text-sm"}),e.jsx("button",{onClick:()=>w(m._id),className:"bg-blue-600 text-white px-4 py-1 rounded-lg mt-2 text-sm",children:"Reply"})]}),m.replies?.length>0&&S(m.replies,m._id)]},m._id))})]})}function lt(){const[a,o]=u.useState("notes"),{courseId:n}=me(),[c,p]=u.useState({}),[d,v]=u.useState("");u.useEffect(()=>{(async()=>{try{const b=await V.get(`http://localhost:5000/api/courses/single/${n}`);p(b.data.course),console.log("course deatils",b.data.course)}catch(b){console.log(`Error fetching in VideoMain: ${b}`)}})()},[n]),u.useEffect(()=>{c?.chapters?.length>0&&!d&&(console.log("Auto-selecting:",c.chapters[0]._id),v(c.chapters[0]._id))},[c]);const y=k=>{console.log("✅ Received lesson ID from child:",k),v(k)},h=c.chapters?.find(k=>k._id===d);return console.log("selected lesson",h,"title",c.courseTitle),e.jsxs("div",{className:"flex flex-col md:flex-row min-h-screen bg-gray-50",children:[e.jsx("div",{className:"md:w-1/4 bg-white shadow-sm border-r",children:e.jsx(Be,{data:c,onLessonClick:y})}),e.jsxs("div",{className:"flex-1 p-6 overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold mb-1",children:["Complete ",c.courseTitle," Course"]}),e.jsx("p",{className:"text-gray-500 mb-6",children:"by Sarah Johnson"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"flex gap-2 text-center border-2 border-gray-300 h-10 text-lg rounded-xl p-2 cursor-pointer hover:bg-blue-400 hover:border-gray-50 hover:text-white ",children:[e.jsx("span",{className:"py-1",children:e.jsx(Me,{})}),e.jsx("span",{children:"Share"})]}),e.jsx("span",{className:"border-2 border-gray-300 h-10 text-3xl rounded-xl py-1 px-1 w-11 cursor-pointer hover:bg-green-400 hover:border-gray-50 hover:text-red-600 ",children:e.jsx(Fe,{})})]})]}),h?e.jsx(xe,{title:h.lessonName,subtitle:h.lessonDescription,videoUrl:h.lessonVideoURL,videoId:h._id,courseId:n}):e.jsx(xe,{}),e.jsx(Ge,{activeTab:a,setActiveTab:o}),a==="notes"&&e.jsx(Je,{courseId:n,lessonId:d}),a==="resources"&&e.jsx(qe,{pdfs:h?.lessonPdf||[]}),a==="assignments"&&e.jsx(Ke,{courseTitle:c.courseTitle}),a==="discussion"&&e.jsx(Qe,{lessonId:d})]})]})}export{lt as default};
