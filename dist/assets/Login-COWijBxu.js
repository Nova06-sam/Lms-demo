import{u as L,r as u,j as e,L as F}from"./index-BAzVzJec.js";import{F as w,a as E,b as G,c as B,d as D}from"./index-BoJ_87Vx.js";import{R}from"./index-DxkRZUkC.js";import{M as W}from"./index-UcFw3JkJ.js";import{y as i,L as J}from"./index-D7sA9hZu.js";/* empty css                      */import{B as q,s as U,a as A,g as Y}from"./login-BwthUOxY.js";import{a as z}from"./index-B9ygI19o.js";import"./iconBase-CAFTq8Rg.js";import"./clsx-B-dksMZM.js";import"./index-DaWSInqW.js";function ae(){const p=L(),[r,S]=u.useState(""),[a,g]=u.useState({email:"",password:"",remember:!1}),[n,h]=u.useState({}),[f,v]=u.useState(!1),[x,j]=u.useState(!1),[d,C]=u.useState({length:!1,uppercase:!1,lowercase:!1,number:!1,specialChar:!1});u.useEffect(()=>{const t=localStorage.getItem("rememberedLogin");if(t){const{email:s,password:o,expiry:m}=JSON.parse(t);Date.now()<m?g(c=>({...c,email:s,password:o,remember:!0})):(localStorage.removeItem("rememberedLogin"),i.info("â° Remember me expired â€” please log in again",{autoClose:3e3,position:"top-center"}))}},[]);const b=t=>{const{name:s,value:o,type:m,checked:l}=t.target;g({...a,[s]:m==="checkbox"?l:o}),n[s]&&h({...n,[s]:""}),s==="password"&&C({length:o.length>=8,uppercase:/[A-Z]/.test(o),lowercase:/[a-z]/.test(o),number:/\d/.test(o),specialChar:/[@$!%*?&]/.test(o)}),s==="remember"&&!l&&localStorage.removeItem("rememberedLogin")},N=t=>{S(t),n.userType&&h({...n,userType:""}),t==="student"?i.success("ðŸŽ“ You chose to Learn as a Student!",{autoClose:2500,position:"top-center"}):t==="teacher"&&i.success("ðŸ‘¨â€ðŸ« You chose to Teach as a Instructor!",{autoClose:2500,position:"top-center"})},k=()=>{let t={};if(r||(t.userType="Please select a role"),a.email?/\S+@\S+\.\S+/.test(a.email)||(t.email="Invalid email address"):t.email="Email is required",!a.password)t.password="Password is required";else{const s=d;s.length?(!s.uppercase||!s.lowercase||!s.number||!s.specialChar)&&(t.password="Password does not meet all requirements"):t.password="Password must be at least 8 characters"}return h(t),Object.keys(t).length===0},I=async t=>{if(t.preventDefault(),!k()){i.error("âŒ Please fix the errors in the form",{position:"top-center",autoClose:4e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0});return}j(!0);const s=r==="student"?`http://localhost:5000/api/students/login/${a.email}`:`http://localhost:5000/api/teachers/login/${a.email}`;try{const o=await z.post(s,{email:a.email,password:a.password}),{token:m,user:l}=o.data;if(!l){i.error("âŒ Backend did not send user data",{position:"top-center"}),console.log("âŒ user undefined:",o.data);return}console.log("âœ… Login Successful:",l),console.log("âœ… Login Successful:",m),localStorage.setItem("token",m),localStorage.setItem("user",JSON.stringify(l));const c=l._id||l.id;if(c?l.role==="student"?(localStorage.setItem("studentId",c),localStorage.removeItem("teacherId"),console.log("student",c)):(l.role==="teacher"||l.role==="instructor")&&(localStorage.setItem("teacherId",c),localStorage.removeItem("studentId"),console.log("Teacher",c)):console.log("âš ï¸ Warning: user._id missing from backend"),a.remember){const $=Date.now()+6e5;localStorage.setItem("rememberedLogin",JSON.stringify({email:a.email,password:a.password,expiry:$}))}i.success(`ðŸŽ‰ Welcome back, ${l.name||"User"}!`,{position:"top-center",autoClose:2e3}),l.role==="student"?p("/student"):(l.role==="teacher"||l.role==="instructor")&&p("/teacher"),g({email:a.remember?a.email:"",password:"",remember:a.remember})}catch(o){console.error("âŒ Login error:",o.response?.data||o.message),i.error(`âŒ ${o.response?.data?.error||"Invalid credentials"}`,{position:"top-center",autoClose:4e3})}finally{j(!1)}},T=()=>{if(!a.email){i.warn("âš ï¸ Please enter your email to reset your password.",{position:"top-center",autoClose:4e3});return}i.info(`ðŸ“© Password reset link sent to ${a.email}`,{position:"top-center",autoClose:4e3})},y=(()=>{const t=d;let s=0;return t.length&&s++,t.lowercase&&s++,t.uppercase&&s++,t.number&&s++,t.specialChar&&s++,{0:{text:"Very Weak",color:"bg-red-500",textColor:"text-red-500"},1:{text:"Weak",color:"bg-red-400",textColor:"text-red-400"},2:{text:"Fair",color:"bg-orange-500",textColor:"text-orange-500"},3:{text:"Good",color:"bg-yellow-500",textColor:"text-yellow-500"},4:{text:"Strong",color:"bg-green-500",textColor:"text-green-500"},5:{text:"Very Strong",color:"bg-green-600",textColor:"text-green-600"}}[s]||{text:"",color:"",textColor:""}})(),P=()=>e.jsxs("div",{className:"mt-3 p-3 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 mb-2",children:"Password Requirements:"}),e.jsx("div",{className:"space-y-1 text-xs",children:[["At least 8 characters",d.length],["One uppercase letter (A-Z)",d.uppercase],["One lowercase letter (a-z)",d.lowercase],["One number (0-9)",d.number],["One special character (@$!%*?&)",d.specialChar]].map(([t,s],o)=>e.jsxs("div",{className:`flex items-center ${s?"text-green-600":"text-red-500"}`,children:[s?e.jsx(w,{className:"mr-2"}):e.jsx(D,{className:"mr-2"})," ",t]},o))})]}),O=async()=>{if(!r){i.error("Please select Student or Teacher first",{position:"top-center",autoClose:4e3});return}try{console.log("ðŸ” Starting Google login for:",r);const s=(await U(A,Y)).user,o=await s.getIdToken(!0),l=await fetch(r==="student"?"http://localhost:5000/api/auth/google/student":"http://localhost:5000/api/auth/google/teacher",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify({role:r==="student"?"student":"teacher"})}),c=await l.json();if(!l.ok){i.error(c.error||"Email not registered. Please sign up first.",{autoClose:4e3,position:"top-center"});return}localStorage.setItem("user",JSON.stringify(c.user)),localStorage.setItem("token",c.token),i.success(`ðŸŽ‰ Welcome back ${c.user.name||s.email}!`,{position:"top-center",autoClose:2500}),p(r==="student"?"/student":"/teacher")}catch(t){console.error("âŒ Google login failed:",t);let s="Google login failed";t.code==="auth/popup-closed-by-user"?s="Google sign-in was cancelled":t.code==="auth/network-request-failed"&&(s="Network error. Please check your connection"),i.error(`âŒ ${s}`,{position:"top-center",autoClose:4e3})}};return e.jsxs("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 p-4",children:[e.jsx(J,{position:"top-center",autoClose:5e3,hideProgressBar:!1,newestOnTop:!1,closeOnClick:!0,rtl:!1,pauseOnFocusLoss:!0,draggable:!0,pauseOnHover:!0,theme:"light"}),e.jsxs("div",{className:"bg-white shadow-md rounded-2xl p-8 w-full max-w-md border border-gray-100",children:[e.jsx(q,{}),e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("img",{src:"https://cdn-icons-png.flaticon.com/512/2921/2921222.png",alt:"EduPlatform",className:"w-10 mx-auto mb-2"}),e.jsx("h1",{className:"text-2xl font-semibold text-gray-800",children:"EduPlatform"}),e.jsx("p",{className:"text-gray-500 text-sm mt-1",children:"Join thousands of learners and instructors"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"text-sm text-gray-600 block mb-3",children:"I want to: *"}),e.jsxs("div",{className:"f-choose gap-3 flex  justify-center",children:[e.jsxs("div",{className:`f-learn f-c-box flex flex-col justify-center p-4 border-2 rounded-sm cursor-pointer transition-all flex-1 text-center ${r==="student"?"border-blue-500 bg-blue-50 shadow-md":"border-gray-300 hover:border-gray-400 bg-white"} ${n.userType?"border-red-500":""}`,onClick:()=>N("student"),children:[e.jsxs("p",{className:"flex justify-center items-center gap-2 font-medium",children:[e.jsx(R,{className:"w-5 h-5"})," Learn"]}),e.jsx("small",{className:"text-gray-600 mt-1",children:"Take courses and earn certification"})]}),e.jsxs("div",{className:`f-teach f-c-box flex flex-col justify-center p-4 border-2 rounded-sm cursor-pointer transition-all flex-1 text-center ${r==="teacher"?"border-blue-500 bg-blue-50 shadow-md":"border-gray-300 hover:border-gray-400 bg-white"} ${n.userType?"border-red-500":""}`,onClick:()=>N("teacher"),children:[e.jsxs("p",{className:"flex justify-center items-center gap-2 font-medium",children:[e.jsx(W,{className:"w-5 h-5"})," Teach"]}),e.jsx("small",{className:"text-gray-600 mt-1",children:"Create and share your knowledge"})]})]}),n.userType&&e.jsx("p",{className:"text-red-500 text-xs mt-2 text-center",children:n.userType}),r&&!n.userType&&e.jsxs("p",{className:"text-green-500 text-xs mt-2 text-center flex items-center justify-center",children:[e.jsx(w,{className:"mr-1"}),"Selected: ",r==="student"?"Student":"Teacher"]})]}),e.jsxs("form",{onSubmit:I,className:`space-y-4 transition-all duration-300 ${r?"opacity-100":"opacity-50 pointer-events-none"}`,children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 text-center border-b pb-2",children:r==="student"?"Student Sign In":r==="teacher"?"Teacher Sign In":"Select Your Role"}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Email *"}),e.jsx("input",{type:"email",name:"email",value:a.email,onChange:b,style:{textTransform:"lowercase"},placeholder:"john.doe@example.com",className:`w-full mt-1 px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none transition-colors ${n.email?"border-red-500":"border-gray-300"}`,disabled:!r}),e.jsx("p",{className:"text-red-500 text-xs mt-1",children:n.email}),a.email&&!n.email&&e.jsxs("p",{className:"text-green-500 text-xs mt-1 flex items-center",children:[e.jsx(w,{className:"mr-1"})," Valid email format"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Password *"}),e.jsx("input",{type:f?"text":"password",name:"password",value:a.password,onChange:b,placeholder:"Enter your password",className:`w-full mt-1 px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none transition-colors ${n.password?"border-red-500":"border-gray-300"}`,disabled:!r}),e.jsx("button",{type:"button",onClick:()=>v(!f),className:"absolute right-3 top-10 text-gray-500 hover:text-gray-700 transition-colors",disabled:!r,children:f?e.jsx(E,{}):e.jsx(G,{})}),e.jsx("p",{className:"text-red-500 text-xs mt-1",children:n.password}),a.password&&e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"flex justify-between text-xs mb-1",children:[e.jsx("span",{children:"Password Strength:"}),e.jsx("span",{className:`font-medium ${y.textColor}`,children:y.text})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mb-2",children:e.jsx("div",{className:`h-2 rounded-full ${y.color}`,style:{width:`${Object.values(d).filter(Boolean).length/5*100}%`}})}),e.jsx(P,{})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",name:"remember",checked:a.remember,onChange:b,className:"accent-blue-600 cursor-pointer transition-colors",disabled:!r}),e.jsx("span",{className:"text-gray-600",children:"Remember me"})]}),e.jsx("button",{type:"button",onClick:T,className:"text-blue-600 hover:underline cursor-pointer text-sm transition-colors",disabled:!r,children:"Forgot Password?"})]}),e.jsx("button",{type:"submit",className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 rounded-sm transition-all duration-300 disabled:bg-blue-300 disabled:cursor-not-allowed transform hover:scale-[1.02] active:scale-[0.98] flex items-center justify-center",disabled:Object.keys(n).some(t=>n[t])||!r||x,children:x?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Signing In..."]}):r?`Sign In as ${r==="student"?"Student":"Teacher"}`:"Select Your Role First"}),e.jsxs("div",{className:"flex items-center my-4",children:[e.jsx("hr",{className:" border-gray-300"}),e.jsx("span",{className:"px-3 text-gray-400 text-sm",children:"OR CONTINUE WITH"}),e.jsx("hr",{className:" border-gray-300"})]}),e.jsx("button",{type:"button",className:"w-full border border-gray-300 py-3 rounded-lg flex items-center justify-center gap-3 hover:bg-gray-50 transition-all duration-300 transform hover:scale-[1.02] active:scale-[0.98] disabled:opacity-50 disabled:cursor-not-allowed",onClick:O,disabled:!r||x,children:x?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-gray-600 mr-2"}),"Connecting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"text-red-500 text-lg"}),e.jsx("span",{children:"Continue with Google"})]})})]}),e.jsxs("p",{className:"text-center text-sm text-gray-600 mt-6",children:["Don't have an account?"," ",e.jsx(F,{to:"/signup",className:"text-blue-600 hover:underline font-medium transition-colors",children:"Sign Up"})]})]})]})}export{ae as default};
